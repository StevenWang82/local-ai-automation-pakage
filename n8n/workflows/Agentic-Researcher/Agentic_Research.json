{
  "name": "Agentic-Research",
  "nodes": [
    {
      "parameters": {
        "public": true,
        "initialMessages": "",
        "options": {
          "loadPreviousSession": "memory",
          "title": "Research Agent ! ğŸ‘‹"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -920,
        80
      ],
      "id": "74ca354c-36e9-4c20-a237-82f06b9c4233",
      "name": "When chat message received",
      "webhookId": "9e0aef8d-ef61-4ad6-a944-7645c4febfaa"
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-04-17",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        540,
        160
      ],
      "id": "ad4c0138-3dcb-4a83-ae78-9bfdf938c04a",
      "name": "Google Gemini Chat Model",
      "credentials": {
        "googlePalmApi": {
          "id": "qO5NASFECwvuJ7Li",
          "name": "Gemini - CoL"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 30
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        540,
        -20
      ],
      "id": "781ab328-3b43-4bb5-99ff-a100a7bf0d0f",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "af58493b-b8a8-4f4e-bff1-921b90a6c3c5",
              "name": "sessionID",
              "value": "={{ $json.sessionId }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -440,
        -140
      ],
      "id": "e8508ed7-1be9-4142-a0a5-bfc584ea8aac",
      "name": "session_id"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=è«‹é–‹å§‹é‡æ–°æ½¤é£¾ã€æ”¹å¯«ä»¥ä¸‹å…§å®¹ï¼š\n {{ $json.chatInput }}",
        "options": {
          "systemMessage": "=# è§’è‰²ï¼š\nä½ æ˜¯ä¸€ä½å°ˆç²¾æ–¼å¤§å‹èªè¨€æ¨¡å‹ (LLM) å°ˆå®¶\n\n# ç›®æ¨™ï¼š\næ¥æ”¶ä½¿ç”¨è€…æä¾›çš„åŸå§‹è³‡è¨Šï¼Œä¸¦å°‡å…¶è½‰æ›ç‚ºå° LLM è€Œè¨€æ›´å…¨é¢ã€æ›´ç²¾ç¢ºã€ä¸”æ˜“æ–¼ç†è§£èˆ‡éµå¾ªçš„å„ªåŒ–ç‰ˆæœ¬ã€‚\n\n# ä»»å‹™ï¼š\n1.  ä»”ç´°é–±è®€ä¸¦ç†è§£ä½¿ç”¨è€…å‚³å…¥çš„åŸå§‹è³‡è¨Šæˆ–æç¤ºè©çš„æ ¸å¿ƒæ„åœ–èˆ‡éœ€æ±‚ã€‚\n2.  åˆ†æåŸå§‹æç¤ºè©çš„ä¸è¶³ä¹‹è™•ï¼Œä¾‹å¦‚æ½›åœ¨çš„æ­§ç¾©ã€çµæ§‹ä¸æ¸…ã€æŒ‡ä»¤ä¸æ˜ç¢ºç­‰ã€‚\n3.  æ ¹æ“šå°ä½¿ç”¨è€…æ„åœ–çš„ç†è§£ï¼Œä¸¦è€ƒé‡ LLM çš„è™•ç†ç‰¹æ€§ï¼Œé‡å¯«ä¸¦å„ªåŒ–æç¤ºè©ã€‚\n\n# è¼¸å‡ºæ ¼å¼ï¼š\n* è¼¸å‡ºå…§å®¹åƒ…åŒ…å«å„ªåŒ–å¾Œçš„æç¤ºè©æœ¬èº«ã€‚\n* å›è¦†èªè¨€æ‡‰èˆ‡ä½¿ç”¨è€…åŸå§‹è¼¸å…¥çš„èªè¨€ç›¸åŒã€‚\n* è«‹å‹¿ç›´æ¥å›ç­”ç”¨æˆ¶æå•\n\n# é™åˆ¶ï¼š\n* è«‹å‹¿ç”Ÿæˆä¸€å€‹Agent promptï¼Œè€Œæ˜¯æ‰¼è¦æ½¤é£¾åŸå§‹å•é¡Œã€‚\n\n\nç›®å‰æ—¥æœŸèˆ‡æ™‚é–“ï¼š\n{{ $now }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        -560,
        80
      ],
      "id": "cdb3638c-a538-4db3-99b2-c4fc3a2ae345",
      "name": "start-agent"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        -140,
        -120
      ],
      "id": "1811fdb8-45d0-4981-8a19-62d03d0aa168",
      "name": "Merge"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a952ad5e-2c46-46b6-9845-82289bf9c4d1",
              "name": "sessionId",
              "value": "={{ $json.body.sessionID }}",
              "type": "string"
            },
            {
              "id": "9a16f57d-d34b-4e89-8819-4df4f9c10049",
              "name": "connent",
              "value": "={{ $json.body.content }}",
              "type": "string"
            },
            {
              "id": "5cced10a-e6ab-4160-859b-2f5bb269948c",
              "name": "agent",
              "value": "planner",
              "type": "string"
            },
            {
              "id": "cca266bc-b782-43c3-9b8a-fac48695b51e",
              "name": "webhook",
              "value": "agentic-researcher",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -660,
        -740
      ],
      "id": "892fc54a-bf9e-470f-814e-6f84e00612cb",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "jsCode": "// å¾å‰ä¸€å€‹ç¯€é»å–å‡º JSON è³‡æ–™çš„å‡½æ•¸\nfunction extractJsonFromPreviousNode() {\n  // ç²å–å‰ä¸€å€‹ç¯€é»çš„è¼¸å‡º\n  const items = $input.all();\n  \n  // æª¢æŸ¥æ˜¯å¦æœ‰è³‡æ–™\n  if (!items || items.length === 0) {\n    throw new Error('æ²’æœ‰æ¥æ”¶åˆ°å‰ä¸€å€‹ç¯€é»çš„è³‡æ–™');\n  }\n  \n  // å¾ç¬¬ä¸€å€‹é …ç›®ä¸­å–å‡º output å­—æ®µ\n  const rawOutput = items[0].json.output;\n  \n  if (!rawOutput) {\n    throw new Error('è¼¸å‡ºä¸­æ²’æœ‰æ‰¾åˆ° output å­—æ®µ');\n  }\n  \n  try {\n    // å»é™¤ Markdown ä»£ç¢¼å¡Šæ¨™è¨˜ (```json å’Œ ```)\n    const jsonString = rawOutput.replace(/```json\\n|\\n```/g, '');\n    \n    // è§£æ JSON å­—ç¬¦ä¸²ç‚ºå°è±¡\n    const parsedData = JSON.parse(jsonString);\n    \n    // è¿”å›è§£æå¾Œçš„ JSON å°è±¡\n    return parsedData;\n  } catch (error) {\n    throw new Error(`è§£æ JSON æ™‚å‡ºéŒ¯: ${error.message}`);\n  }\n}\n\n// åŸ·è¡Œå‡½æ•¸ä¸¦è¿”å›çµæœ\nreturn extractJsonFromPreviousNode();"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -80,
        -580
      ],
      "id": "e63e5f84-0a4d-4efb-8667-d2a56390279f",
      "name": "json parser"
    },
    {
      "parameters": {
        "mode": "combine",
        "combineBy": "combineAll",
        "options": {}
      },
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.1,
      "position": [
        100,
        -720
      ],
      "id": "58e30cca-6e00-49b2-b948-b566fb4a4265",
      "name": "Merge1"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "agentic-planner",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -900,
        -580
      ],
      "id": "f03b8650-16cd-478c-822d-9598e8f12182",
      "name": "agentic-planner",
      "webhookId": "c2b367bf-710f-44cb-a12d-013bdaed127d"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "http://host.docker.internal:5678/webhook/agentic-planner",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "sessionID",
              "value": "={{ $json.sessionID }}"
            },
            {
              "name": "content",
              "value": "={{ $json.output }}"
            },
            {
              "name": "agent_from",
              "value": "start-agent"
            }
          ]
        },
        "options": {
          "response": {
            "response": {}
          }
        }
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        80,
        -120
      ],
      "id": "fdd0d2cc-bc3c-4917-b267-b37e4eaab7a6",
      "name": "HTTP Request to Planner"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ç”¨æˆ¶éœ€æ±‚èˆ‡æå•ï¼š\n {{ $json.connent }}",
        "options": {
          "systemMessage": "=# è§’è‰²ï¼š\næ‚¨æ˜¯ä¸€å€‹å°ˆæ¥­çš„ç ”ç©¶è¦åŠƒå¸«ï¼Œä½ æ“…é•·æ‹†è§£ä½¿ç”¨è€…å•é¡Œéœ€æ±‚ï¼Œã€Œç”Ÿæˆå¤šå€‹é«˜åº¦ç›¸é—œä¸”ä¸”æ·±å…¥çš„æœå°‹ä¸»é¡Œã€ï¼Œä»¥ä¾¿å¾ŒçºŒç ”ç©¶ã€‚\n\n# ä»»å‹™ï¼š\n1. åˆ†è§£ä¸»é¡Œï¼šè­˜åˆ¥3-5å€‹ç¨ç‰¹ä½†ç›¸äº’é—œè¯çš„å­ä¸»é¡Œï¼Œé€™å°‡æä¾›å°ä¸»è¦æœå°‹ä¸»é¡Œçš„å…¨é¢ç†è§£ã€‚\n2. ç¢ºä¿æ·±åº¦å’Œç›¸é—œæ€§ï¼šæ¯å€‹æœå°‹ä¸»é¡Œæ‡‰è©²è¶³å¤ å…·é«”ä»¥å…è¨±æ·±å…¥æ¢ç´¢ï¼Œä½†åˆè¶³å¤ å»£æ³›ä»¥æä¾›æœ‰æ„ç¾©çš„è¦‹è§£ã€‚\n3. é¿å…å†—é¤˜ï¼šé€™äº›æœå°‹ä¸»é¡Œï¼Œæ‡‰è©²æ˜¯ç¨ç‰¹çš„ï¼Œä¸¦æ¶µè“‹ä¸»è¦ä¸»é¡Œçš„ä¸åŒæ–¹é¢ã€‚\n\n\nè¼¸å‡ºæ ¼å¼ï¼š\n- **è«‹å‹™å¿…ä»¥JSONæ ¼å¼è¼¸å‡º**\n\n## è¼¸å‡ºæ ¼å¼ (JSON)ï¼š\n{\n\"output\": [\"<ç¬¬ä¸€å€‹æ·±å…¥æœå°‹ä¸»é¡Œ>\",\"<ç¬¬äºŒå€‹æ·±å…¥æœå°‹ä¸»é¡Œ>\", \"<ç¬¬ä¸‰å€‹æ·±å…¥æœå°‹ä¸»é¡Œ>\", /// ä¾æ­¤é¡æ¨]\n}\n\nç›®å‰æ—¥æœŸèˆ‡æ™‚é–“ï¼š\n{{ $now }}\n\n\n## æœ€çµ‚æ³¨æ„äº‹é …\n- æ‚¨çš„å›æ‡‰æ‡‰è©²ç°¡æ½”ã€ç›¸é—œä¸”çµæ§‹è‰¯å¥½ï¼Œä»¥æœ‰æ•ˆå¼•å°æ·±å…¥ç ”ç©¶ã€‚\n- é™¤äº†å›æ‡‰å­æœå°‹ä¸»é¡Œï¼Œç„¡é ˆå…¶ä»–ä»»ä½•èªªæ˜å›æ‡‰ã€‚"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        -440,
        -580
      ],
      "id": "ce1e84aa-d398-442a-8fad-8d4a3152d260",
      "name": "planner-agent"
    },
    {
      "parameters": {
        "content": "## Starter\n",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -940,
        -140
      ],
      "id": "b42f6817-0996-4e55-a071-8deb75e6be5f",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## Planner\n",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -940,
        -880
      ],
      "id": "7bafb0c6-87ea-4751-9961-e61036886cdd",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## Researcher\n",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        800,
        -880
      ],
      "id": "604e23a1-f2c1-4d37-93c7-6c050f197451",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "agentic-researcher",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        800,
        -600
      ],
      "id": "e743d87b-b1c0-45c3-8a79-e7618f29f273",
      "name": "agentic-researcher",
      "webhookId": "c2b367bf-710f-44cb-a12d-013bdaed127d"
    },
    {
      "parameters": {
        "sseEndpoint": "http://host.docker.internal:5678/mcp/research-tool/sse"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        1960,
        -360
      ],
      "id": "244de6d1-677a-4a47-b872-4548f4585bab",
      "name": "Research Tool"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ç ”ç©¶ä¸»é¡Œ:ã€Œ{{ $json.content }}ã€",
        "options": {
          "systemMessage": "=# è§’è‰²ï¼š\né—œéµå­—ç”¢ç”Ÿå™¨èˆ‡å¤–éƒ¨è³‡æ–™æœå°‹ä»£ç†ã€‚\n\n# ä»»å‹™ç›®æ¨™ï¼š\næ ¹æ“šä½¿ç”¨è€…æä¾›çš„ã€Œç ”ç©¶ä¸»é¡Œã€ï¼Œç”¢ç”Ÿä¸€çµ„ç›¸é—œä¸”ç²¾ç¢ºçš„é—œéµå­—ï¼Œä¸¦åˆ©ç”¨é€™äº›é—œéµå­—é€²è¡Œå¤–éƒ¨è³‡æ–™æŸ¥è©¢ã€‚\n\n# è¼¸å…¥ï¼š\nä½¿ç”¨è€…å°‡æä¾›ä¸€å€‹æ˜ç¢ºçš„ã€Œç ”ç©¶ä¸»é¡Œã€ã€‚\n\n# è¼¸å‡ºï¼š\nè«‹æ ¹æ“šç”Ÿæˆçš„é—œéµå­—ï¼ŒåŸ·è¡Œå¤–éƒ¨æœå°‹ï¼Œä¸¦å›å‚³æœå°‹çµæœã€‚\n\n# åŸ·è¡Œæ­¥é©Ÿï¼š\n1. æ¥æ”¶ä¸¦ç†è§£ä½¿ç”¨è€…æä¾›çš„ã€Œç ”ç©¶ä¸»é¡Œã€ã€‚\n2. åˆ†æä¸»é¡Œçš„æ ¸å¿ƒæ¦‚å¿µï¼Œç”¢ç”Ÿèƒ½ä»£è¡¨è©²ä¸»é¡Œçš„é—œéµå­—ã€‚\n3. ä½¿ç”¨ç”¢ç”Ÿçš„é—œéµå­—åŸ·è¡Œå¤–éƒ¨è³‡æ–™æœå°‹\n4. æ ¹æ“šå¤–éƒ¨æœå°‹çµæœï¼Œæ’°å¯«ä¸€ä»½å®Œæ•´å ±å‘Šã€‚\n\n# å ±å‘Šæ’°å¯«æŒ‡å—\n1.  **éµå¾ªæ ¼å¼è¦æ±‚** - å ±å‘Šå¿…é ˆåš´æ ¼éµå¾ª Markdown æ ¼å¼è¦ç¯„ï¼Œç¢ºä¿æ¨™é¡Œã€åˆ—è¡¨ã€æ®µè½ç­‰å…ƒç´ çš„ä¸€è‡´æ€§ã€‚\n\n2.  **çµæ§‹èˆ‡æ ¼å¼åŒ–** - å ±å‘Šæ‡‰å…·æœ‰è‰¯å¥½çš„çµæ§‹ï¼Œä¸¦ä»¥å°ˆæ¥­ **Markdown** æ ¼å¼å‘ˆç¾ã€‚\n    *   **æ¨™é¡Œ (`#`)** â€“ ä¾ã€ŒTitleã€æä¾›ï¼Œä½¿ç”¨é ‚ç´š Markdown æ¨™é¡Œ (#)ã€‚\n    *   **å…§å®¹ä¸»é«”** â€“ å…·æœ‰é©ç•¶åˆ†ç¯€ (`##`, `###`, æ®µè½) çš„å®Œå…¨æ ¼å¼åŒ–ç ”ç©¶å…§å®¹ã€‚\n        *   ä½¿ç”¨æ¨™æº–çš„æ›è¡Œï¼ˆç©ºè¡Œï¼‰ä¾†å€éš”æ®µè½ã€‚\n        *   ä½¿ç”¨ `*` æˆ– `-` æ­é…ç¸®æ’ä¾†è¡¨ç¤ºç„¡åºåˆ—è¡¨ï¼Œä½¿ç”¨ `1.` ç­‰ä¾†è¡¨ç¤ºæœ‰åºåˆ—è¡¨ã€‚\n    *   ä¸éœ€ã€Œç¸½è¦½ã€(Overview) æˆ–ã€Œçµè«–ã€(Conclusion) çš„æ¨™é¡Œï¼Œåªéœ€è¼¸å‡ºå®Œæ•´çš„å ±å‘Šå…§å®¹å³å¯ã€‚\n \n3.  **åŸºæ–¼ç ”ç©¶çš„å…§å®¹** - æœ‰é‚è¼¯åœ°æ•´åˆè³‡è¨Šï¼Œä¸¦ç¢ºä¿å ±å‘Šç¶“éå……åˆ†ç ”ç©¶ã€äº‹å¯¦æ­£ç¢ºä¸”å°ˆæ¥­åœ°æ’°å¯«ã€‚\n    *   ä½¿ç”¨è³‡è¨Šè±å¯Œçš„å¯«æ³•ã€‚æä¾›ç›¡å¯èƒ½å¤šçš„ç´°ç¯€ã€‚\n    *   ä¿æŒæ€æƒ³çš„é‚è¼¯é †åºï¼Œæœ‰æ•ˆåœ°ç¸½çµè¦é»ã€‚\n\n\n## å ±å‘Šç¯„ä¾‹\n\n## ç¯„ä¾‹è¼¸å‡ºçµæ§‹ (æ‡‰ç”¨æ ¼å¼è¦æ±‚)\n\n# é™åˆ¶\n1. åƒ…éœ€å›å‚³å ±å‘Šå…§å®¹ï¼Œç„¡é ˆå†é–‹é ­ä½œä»»ä½•å…¶ä»–èªªæ˜\n2. æœ€çµ‚å ±å‘Šè«‹ä»¥ç¬¦åˆå°ç£æƒ…å¢ƒçš„ç¹é«”ä¸­æ–‡æ’°å¯«ã€‚\n\n\nç›®å‰æ—¥æœŸèˆ‡æ™‚é–“ï¼š\n{{ $now }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        1720,
        -600
      ],
      "id": "7ce3e33d-bbe9-42c2-9734-6a0b2a1750c2",
      "name": "researcher-agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1480,
        -600
      ],
      "id": "1222de2d-220e-4112-af67-b291326825a7",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "fieldToSplitOut": "content",
        "include": "allOtherFields",
        "options": {}
      },
      "type": "n8n-nodes-base.splitOut",
      "typeVersion": 1,
      "position": [
        1220,
        -600
      ],
      "id": "d708a151-bbc3-4889-9f0c-1d5f9f3d341a",
      "name": "Split Out"
    },
    {
      "parameters": {
        "jsCode": "// é€™å€‹å‡½æ•¸ç”¨æ–¼æ¸…ç†å¾AI Agentå¾—åˆ°çš„markdownè¼¸å‡º\nfunction cleanupMarkdown(items) {\n  // é‡å°æ¯å€‹è¼¸å…¥é …ç›®é€²è¡Œè™•ç†\n  return items.map(item => {\n    let output = item.json.output || '';\n    \n    // å»é™¤èµ·å§‹å’Œçµå°¾çš„markdownæ¨™è¨˜å’Œæ›è¡Œç¬¦\n    output = output.replace(/^['\"]?```markdown\\s*\\n?/i, '');\n    output = output.replace(/\\n?```['\"]?$/i, '');\n    \n    // å»é™¤å¤šé¤˜çš„è·³è„«å­—å…ƒ(\\n)\n    output = output.replace(/\\\\n/g, '\\n');\n    \n    // å»é™¤å¯èƒ½çš„JSONå­—ç¬¦ä¸²å¼•è™Ÿ\n    if (output.startsWith('\"') && output.endsWith('\"')) {\n      output = output.slice(1, -1);\n    }\n\n    // è¿”å›æ¸…ç†å¾Œçš„markdown\n    return {\n      ...item.json,\n      output: output\n    };\n  });\n}\n\n// ä½¿ç”¨functionè™•ç†itemsä¸¦è¿”å›çµæœ\nreturn cleanupMarkdown($input.all());"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2240,
        -600
      ],
      "id": "9ac97713-b5dc-402f-b6c0-f559748c8aed",
      "name": "Markdown Parser3"
    },
    {
      "parameters": {
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1T8F5xHaEvzoTdJ8SwmPHntiOsMyLWPfMxRG_3XPe5pY",
          "mode": "list",
          "cachedResultName": "Agentic-Research-Database",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1T8F5xHaEvzoTdJ8SwmPHntiOsMyLWPfMxRG_3XPe5pY/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "research_output",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1T8F5xHaEvzoTdJ8SwmPHntiOsMyLWPfMxRG_3XPe5pY/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "sessionId": "={{ $node['Loop Over Items'].json.sessionId }}",
            "topic": "={{ $node['Loop Over Items'].json.content }}",
            "research_output": "={{ $json.output }}"
          },
          "matchingColumns": [],
          "schema": [
            {
              "id": "sessionId",
              "displayName": "sessionId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "topic",
              "displayName": "topic",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "research_output",
              "displayName": "research_output",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.5,
      "position": [
        2440,
        -600
      ],
      "id": "26e4e7ba-7d24-49da-b530-1a3e754a33de",
      "name": "Google Sheets",
      "credentials": {
        "googleSheetsOAuth2Api": {
          "id": "6m4TJIgG5mP2JOZi",
          "name": "Google Sheets account"
        }
      }
    },
    {
      "parameters": {
        "fieldsToAggregate": {
          "fieldToAggregate": [
            {
              "fieldToAggregate": "sessionId"
            },
            {
              "fieldToAggregate": "topic"
            },
            {
              "fieldToAggregate": "research_output"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        1640,
        -840
      ],
      "id": "50004291-17ee-4069-8ca0-0e584524ac67",
      "name": "Aggregate"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4b255b50-2948-4641-84d0-83ca6d8c1de3",
              "name": "sessionId",
              "value": "={{ $json.sessionId[0] }}",
              "type": "string"
            },
            {
              "id": "76434230-da8f-491e-bda7-91206953e23f",
              "name": "topic",
              "value": "={{ $json.topic }}",
              "type": "array"
            },
            {
              "id": "a979fb7c-8e02-4a66-a08b-44ccb5aa2ce9",
              "name": "research_output",
              "value": "={{ $json.research_output }}",
              "type": "array"
            },
            {
              "id": "239a19c4-e98b-4f9a-b504-bf97bcb83e18",
              "name": "webhook",
              "value": "agentic-reporter",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1880,
        -840
      ],
      "id": "2e2b638e-ebc5-462a-8d22-b49f7e1c86a1",
      "name": "Edit Fields2"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a952ad5e-2c46-46b6-9845-82289bf9c4d1",
              "name": "sessionId",
              "value": "={{ $json.body.sessionID }}",
              "type": "string"
            },
            {
              "id": "9a16f57d-d34b-4e89-8819-4df4f9c10049",
              "name": "content",
              "value": "={{ $json.body.content }}",
              "type": "array"
            },
            {
              "id": "5cced10a-e6ab-4160-859b-2f5bb269948c",
              "name": "agent",
              "value": "={{ $json.body.agent }}",
              "type": "string"
            },
            {
              "id": "cca266bc-b782-43c3-9b8a-fac48695b51e",
              "name": "webhook",
              "value": "agentic-researcher",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1000,
        -600
      ],
      "id": "d79ca33f-6b02-482f-945e-47e10d6d3b5c",
      "name": "Edit Fields1"
    },
    {
      "parameters": {
        "content": "## Reporter",
        "height": 80
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        800,
        -220
      ],
      "id": "9aeb7910-8832-4f29-8b9b-f5878b20ed2a",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "mode": "markdownToHtml",
        "markdown": "={{ $json.output }}",
        "options": {}
      },
      "type": "n8n-nodes-base.markdown",
      "typeVersion": 1,
      "position": [
        1920,
        0
      ],
      "id": "f1ec55fa-3a31-4e4f-bef8-15d043994aab",
      "name": "Markdown"
    },
    {
      "parameters": {
        "sendTo": "example@gmail.com",
        "subject": "æ‚¨çš„ç ”ç©¶å ±å‘Šå·²ç”¢ç”Ÿ",
        "message": "={{ $json.data }}",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        2120,
        0
      ],
      "id": "7c1426d3-b394-4731-8f02-34d5e0cb9038",
      "name": "Gmail",
      "webhookId": "bc12bb0e-18eb-46f3-935d-96fd85323f4d",
      "credentials": {
        "gmailOAuth2": {
          "id": "eltvBNs9oxZa8Jc8",
          "name": "Gmail - CoL"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "agentic-reporter",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        800,
        0
      ],
      "id": "3285e773-5b91-443f-b2e7-49f9bcdec346",
      "name": "agentic-writer",
      "webhookId": "c2b367bf-710f-44cb-a12d-013bdaed127d"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "a952ad5e-2c46-46b6-9845-82289bf9c4d1",
              "name": "sessionId",
              "value": "={{ $json.body.sessionID }}",
              "type": "string"
            },
            {
              "id": "9a16f57d-d34b-4e89-8819-4df4f9c10049",
              "name": "content",
              "value": "={{ $json.body.content }}",
              "type": "array"
            },
            {
              "id": "5cced10a-e6ab-4160-859b-2f5bb269948c",
              "name": "agent",
              "value": "={{ $json.body.agent }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        1060,
        0
      ],
      "id": "a718dc95-06f2-48fa-8c05-e1f5d0848c6a",
      "name": "Edit Fields3"
    },
    {
      "parameters": {
        "jsCode": "// é€™å€‹å‡½æ•¸ç”¨æ–¼æ¸…ç†å¾AI Agentå¾—åˆ°çš„markdownè¼¸å‡º\nfunction cleanupMarkdown(items) {\n  // é‡å°æ¯å€‹è¼¸å…¥é …ç›®é€²è¡Œè™•ç†\n  return items.map(item => {\n    let output = item.json.output || '';\n    \n    // å»é™¤èµ·å§‹å’Œçµå°¾çš„markdownæ¨™è¨˜å’Œæ›è¡Œç¬¦\n    output = output.replace(/^['\"]?```markdown\\s*\\n?/i, '');\n    output = output.replace(/\\n?```['\"]?$/i, '');\n    \n    // å»é™¤å¤šé¤˜çš„è·³è„«å­—å…ƒ(\\n)\n    output = output.replace(/\\\\n/g, '\\n');\n    \n    // å»é™¤å¯èƒ½çš„JSONå­—ç¬¦ä¸²å¼•è™Ÿ\n    if (output.startsWith('\"') && output.endsWith('\"')) {\n      output = output.slice(1, -1);\n    }\n\n    // è¿”å›æ¸…ç†å¾Œçš„markdown\n    return {\n      ...item.json,\n      output: output\n    };\n  });\n}\n\n// ä½¿ç”¨functionè™•ç†itemsä¸¦è¿”å›çµæœ\nreturn cleanupMarkdown($input.all());"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1720,
        0
      ],
      "id": "4d359357-1501-46ad-af71-827864fd9613",
      "name": "Markdown Parser"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "=ç ”ç©¶å­ä¸»é¡Œå ±å‘Š:ã€Œ{{ $json.content }}ã€",
        "options": {
          "systemMessage": "=# è§’è‰²ï¼š\nå¤šæºè³‡è¨Šæ•´åˆèˆ‡å ±å‘Šæ’°å¯«å°ˆå®¶ã€‚\n\n# ä»»å‹™ç›®æ¨™ï¼š\næ¥æ”¶åŸå§‹ä½œè€…æå‡ºçš„å•é¡Œï¼Œä»¥åŠå¤šä»½èˆ‡è©²å•é¡Œç›¸é—œçš„å­ä¸»é¡Œç ”ç©¶å ±å‘Šã€‚ä½ çš„è·è²¬æ˜¯å¾é€™äº›å­ä¸»é¡Œå ±å‘Šä¸­æå–ã€åˆ†æã€æ•´åˆæ‰€æœ‰ç›¸é—œè³‡è¨Šï¼Œä¸¦æ’°å¯«ä¸€ä»½çµæ§‹åš´è¬¹ã€å…§å®¹è©³å¯¦çš„æœ€çµ‚å ±å‘Šï¼Œç›´æ¥ä¸”å®Œæ•´åœ°å›æ‡‰åŸå§‹ä½œè€…çš„å•é¡Œã€‚\n\n# è¼¸å…¥ï¼š\n1.  **åŸå§‹ä½œè€…çš„å•é¡Œï¼š** è©²å•é¡Œæ˜¯æœ¬æ¬¡å ±å‘Šæ’°å¯«çš„æ ¸å¿ƒç›®çš„ã€‚\n2.  **å­ä¸»é¡Œå ±å‘Šå…§å®¹ï¼š** ä¸€ä»½æˆ–å¤šä»½èˆ‡åŸå§‹å•é¡Œç›¸é—œçš„å­ä¸»é¡Œç ”ç©¶å ±å‘Šçš„å®Œæ•´æ–‡æœ¬å…§å®¹ã€‚\n\n# è¼¸å‡ºè¦æ±‚ï¼š\nè«‹æ ¹æ“šè¼¸å…¥çš„è³‡è¨Šï¼Œç”Ÿæˆä¸€ä»½æœ€çµ‚å ±å‘Šï¼Œåš´æ ¼éµå¾ªä»¥ä¸‹æ ¼å¼èˆ‡å…§å®¹è¦æ±‚ï¼š\n\n1.  **æ ¼å¼æ¨™æº–ï¼š** å ±å‘Šå¿…é ˆä½¿ç”¨æ¨™æº– Markdown æ ¼å¼ã€‚\n2.  **ä¸»æ¨™é¡Œï¼š** ï¼Œè«‹æ ¹æ“šåŸå§‹å•é¡Œèˆ‡å­ä¸»é¡Œå ±å‘Šå…§å®¹æ“¬å®šä¸€å€‹åˆé©çš„æ¨™é¡Œï¼Œä½œç‚ºé ‚ç´š Markdown æ¨™é¡Œ `#`ã€‚\n3.  **å…§å®¹çµæ§‹ï¼š**\n    * å ±å‘Šä¸»é«”æ‡‰å…·æœ‰é‚è¼¯åˆ†æ˜çš„çµæ§‹ï¼Œä½¿ç”¨é©ç•¶çš„ Markdown å­æ¨™é¡Œ (`##`, `###`) ä¾†çµ„ç¹”ä¸åŒå€æ®µçš„å…§å®¹ã€‚\n    * æ®µè½ä¹‹é–“ä½¿ç”¨æ¨™æº–çš„ç©ºè¡Œä¾†åˆ†éš”ã€‚\n    * ä½¿ç”¨ Markdown åˆ—è¡¨æ ¼å¼å‘ˆç¾æ¢åˆ—å¼è³‡è¨Šï¼šç„¡åºåˆ—è¡¨ä½¿ç”¨ `*` æˆ– `-` æ­é…ç¸®æ’ï¼›æœ‰åºåˆ—è¡¨ä½¿ç”¨ `1.` ç­‰ã€‚\n4.  **å€æ®µåˆ†éš”ï¼š** åœ¨ä¸»è¦çš„ä¸åŒå…§å®¹å€æ®µä¹‹é–“ï¼Œä½¿ç”¨æ°´å¹³ç·šï¼ˆ`---` æˆ– `***`ï¼Œè‡³å°‘ä¸‰å€‹é€£çºŒç¬¦è™Ÿï¼‰é€²è¡Œè¦–è¦ºåˆ†éš”ã€‚\n5.  **å…§å®¹è¦æ±‚ï¼š**\n    * å ±å‘Šå…§å®¹å¿…é ˆå®Œå…¨åŸºæ–¼ä½ æ‰€æ¥æ”¶åˆ°çš„å­ä¸»é¡Œå ±å‘Šä¸­çš„è³‡è¨Šã€‚\n    * æœ‰é‚è¼¯åœ°æ•´åˆä¾†è‡ªæ‰€æœ‰ç›¸é—œå­å ±å‘Šçš„è§€é»ã€æ•¸æ“šå’Œç´°ç¯€ã€‚\n    * ä¿æŒå°ˆæ¥­ã€å®¢è§€çš„èªæ°£ï¼Œç¢ºä¿å…§å®¹ç¶“éå……åˆ†ã€Œç ”ç©¶ã€ï¼ˆå³åŸºæ–¼æä¾›çš„ææ–™ï¼‰ä¸”äº‹å¯¦æº–ç¢ºï¼ˆä¾è³´æä¾›çš„ææ–™ï¼‰ã€‚\n    * æä¾›ç›¡å¯èƒ½å¤šçš„ç´°ç¯€ï¼Œä»¥ç¢ºä¿å ±å‘Šå…§å®¹è±å¯Œã€‚\n    * æ ¸å¿ƒç›®æ¨™æ˜¯ç›´æ¥ã€æ¸…æ™°ã€å®Œæ•´åœ°å›ç­”åŸå§‹ä½œè€…çš„å•é¡Œï¼Œä¸¦ä¿æŒæ€æƒ³çš„é‚è¼¯é€£è²«æ€§ã€‚\n\n\nç›®å‰æ—¥æœŸèˆ‡æ™‚é–“ï¼š\n{{ $now }}"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.8,
      "position": [
        1340,
        0
      ],
      "id": "12a0840a-ed96-4e85-9fbb-2a7b60ecaec7",
      "name": "reporter-agent"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://host.docker.internal:5678/webhook/{{ $json.webhook }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "sessionID",
              "value": "={{ $json.sessionId }}"
            },
            {
              "name": "content",
              "value": "={{ $json.output }}"
            },
            {
              "name": "agent",
              "value": "={{ $json.agent }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        280,
        -580
      ],
      "id": "4a272db7-a92f-47f6-a918-9ca7464da798",
      "name": "HTTP Request to Researcher"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "=http://host.docker.internal:5678/webhook/{{ $json.webhook }}",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "sessionID",
              "value": "={{ $json.sessionId }}"
            },
            {
              "name": "content",
              "value": "={{ $json.research_output }}"
            },
            {
              "name": "agent",
              "value": "=researcher"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        2140,
        -840
      ],
      "id": "2dc8336a-20db-4081-a613-48e32239588c",
      "name": "HTTP Request to Reporter"
    }
  ],
  "pinData": {},
  "connections": {
    "When chat message received": {
      "main": [
        [
          {
            "node": "start-agent",
            "type": "main",
            "index": 0
          },
          {
            "node": "session_id",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "start-agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "planner-agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "researcher-agent",
            "type": "ai_languageModel",
            "index": 0
          },
          {
            "node": "reporter-agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "start-agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "planner-agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "researcher-agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "reporter-agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "session_id": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "start-agent": {
      "main": [
        [
          {
            "node": "Merge",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge": {
      "main": [
        [
          {
            "node": "HTTP Request to Planner",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 0
          },
          {
            "node": "planner-agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "json parser": {
      "main": [
        [
          {
            "node": "Merge1",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "Merge1": {
      "main": [
        [
          {
            "node": "HTTP Request to Researcher",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agentic-planner": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "planner-agent": {
      "main": [
        [
          {
            "node": "json parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agentic-researcher": {
      "main": [
        [
          {
            "node": "Edit Fields1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Research Tool": {
      "ai_tool": [
        [
          {
            "node": "researcher-agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "researcher-agent": {
      "main": [
        [
          {
            "node": "Markdown Parser3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [
          {
            "node": "Aggregate",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "researcher-agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Split Out": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Markdown Parser3": {
      "main": [
        [
          {
            "node": "Google Sheets",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Sheets": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Aggregate": {
      "main": [
        [
          {
            "node": "Edit Fields2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields2": {
      "main": [
        [
          {
            "node": "HTTP Request to Reporter",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields1": {
      "main": [
        [
          {
            "node": "Split Out",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Markdown": {
      "main": [
        [
          {
            "node": "Gmail",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "agentic-writer": {
      "main": [
        [
          {
            "node": "Edit Fields3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields3": {
      "main": [
        [
          {
            "node": "reporter-agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Markdown Parser": {
      "main": [
        [
          {
            "node": "Markdown",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "reporter-agent": {
      "main": [
        [
          {
            "node": "Markdown Parser",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1",
    "callerPolicy": "workflowsFromSameOwner",
    "executionTimeout": -1,
    "errorWorkflow": "lbHeKk9wCR7g09om"
  },
  "versionId": "bddd9a0b-05c6-463a-954d-727e3dd73ab8",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "0903d4738bfceb212abe7417386268a386894b588376561033446cb99ecbb6eb"
  },
  "id": "MHHosJDV2PaxxVNE",
  "tags": []
}